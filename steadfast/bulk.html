<!DOCTYPE html>
<html lang="bn">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Steadfast Bulk Booking Tool</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f6f7f8;
      --card: #fff;
      --muted: #6b7280;
      --accent: #10b981;
      --danger: #ef4444;
      --border: #e6eef6;
      --text: #1f2937;
    }

    body {
      margin: 0;
      padding: 14px;
      background: var(--bg);
      font-family: 'Poppins', system-ui, sans-serif;
      color: var(--text);
    }

    .wrap {
      max-width: 1100px;
      margin: 8px auto;
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.04);
    }

    h1 {
      font-size: 18px;
      margin: 0 0 15px
    }

    .btn {
      display: inline-block;
      padding: 8px 10px;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: 0.2s
    }

    .btn-primary {
      background: var(--accent);
      color: #fff
    }

    .btn-secondary {
      background: #fff;
      color: #374151;
      border: 1px solid #d1d5db
    }

    textarea {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      box-sizing: border-box;
      font-family: inherit;
      margin-bottom: 15px
    }

    .note-input {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 15px;
      font-family: inherit;
      box-sizing: border-box
    }

    .table-container {
      margin-top: 20px;
      overflow-x: auto
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px
    }

    th,
    td {
      padding: 10px;
      border: 1px solid var(--border);
      text-align: left;
      font-size: 12px;
    }

    th {
      background: #f9fafb;
      font-weight: 600
    }

    .status-pending {
      color: orange
    }

    .status-success {
      color: var(--accent);
      font-weight: bold
    }

    .status-error {
      color: var(--danger)
    }

    .key-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f0fffa;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #d1fae5;
      font-size: 13px
    }

    .parcel-id-box {
      display: flex;
      flex-direction: column;
      gap: 4px;
      background: #e6fcf5;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #c2f3e1;
      min-width: 120px;
    }

    .id-text {
      font-size: 11px;
      font-weight: 600;
      color: #065f46;
      margin-bottom: 2px
    }

    .delete-btn {
      background: var(--danger);
      color: #fff;
      border: none;
      padding: 4px 6px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 10px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.2s;
    }

    .delete-btn:hover {
      background: #dc2626;
      opacity: 0.9;
    }

    footer {
      margin-top: 30px;
      text-align: center;
      color: var(--muted);
      font-size: 13px
    }

    .footer-link {
      color: var(--accent);
      text-decoration: none;
      margin: 0 5px
    }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BFD7N30L1X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-BFD7N30L1X');
  </script>
</head>

<body>
  <div class="wrap">
    <div class="settings-bar"
      style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border: 1px solid var(--border); padding: 12px; border-radius: 10px; background: #fff;">
      <h1 style="margin:0">Steadfast Easy Bulk Booking</h1>
      <a href="index.html" class="btn btn-secondary" style="text-decoration:none">‚öôÔ∏è API Keys</a>
    </div>

    <div id="keyInfo" class="key-bar" style="display:none;"></div>

    <section>
      <label style="display:block;margin-bottom:8px;font-weight:600">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡¶ø‡¶® (‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡ßá‡¶∞
        ‡¶Æ‡¶æ‡¶ù‡ßá <code style="background:#eee;padding:2px 4px">---</code> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®)</label>
      <textarea id="bulkInput" placeholder="‡¶®‡¶æ‡¶Æ: ‡¶Ø‡¶æ‡ßü‡ßá‡¶¶
‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: ‡¶Æ‡¶ø‡¶∞‡¶™‡ßÅ‡¶∞, ‡¶¢‡¶æ‡¶ï‡¶æ
01700000000 (‡¶´‡ßã‡¶®)
500tk (‡¶∏‡¶ø‡¶ì‡¶°‡¶ø)
---
‡¶π‡¶æ‡¶Æ‡¶ø‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®
‡¶®‡¶ø‡¶â‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü, ‡¶Ø‡¶∂‡ßã‡¶∞‡•§
01800000000
1000"></textarea>

      <div style="display:flex;gap:10px">
        <button id="extractBtn" class="btn btn-primary">‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button id="clearBtn" class="btn btn-secondary">‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞</button>
      </div>
    </section>

    <div class="table-container" id="tableWrap" style="display:none">
      <h3>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü (<span id="count">0</span>)</h3>
      <table id="orderTable">
        <thead>
          <tr>
            <th style="width: 40px;">#</th>
            <th>‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏</th>
            <th>‡¶®‡¶æ‡¶Æ</th>
            <th>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</th>
            <th>‡¶´‡ßã‡¶®</th>
            <th>COD</th>
            <th>‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</th>
            <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ / Parcel ID</th>
          </tr>
        </thead>
        <tbody id="orderBody"></tbody>
      </table>

      <!-- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Ö‡¶ü‡ßã-‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø -->
      <form onsubmit="return false;"
        style="margin-top:20px; background:#f9fafb; padding:15px; border-radius:10px; border:1px dashed #d1d5db">
        <label for="commonNote" style="display:block;margin-bottom:8px;font-weight:600;font-size:14px">‡¶ï‡¶Æ‡¶® ‡¶®‡ßã‡¶ü (‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã
          ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)</label>
        <input type="text" id="commonNote" name="common_note" autocomplete="on" class="note-input"
          placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®‡ßá ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ï‡¶∞‡¶¨‡ßá‡¶® / ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶¨‡¶≤‡¶¨‡ßá‡¶®">

        <button id="submitBulkBtn" class="btn btn-primary" style="width:100%; padding:15px; font-size:16px">‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã
          ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶¶‡¶ø‡¶®</button>
      </form>
    </div>

    <div id="summary" style="margin-top:15px; font-weight:600; text-align:center"></div>
  </div>

  <footer>
    <div class="footer-links">
      <a href="ai.html" class="footer-link"><b>üÜï Ai Bulk Entry</b></a> |
      <a href="index.html" class="footer-link"><b>üì¶ Single Entry</b></a> |
      <a href="https://tools.sukkarshop.com" class="footer-link">üõ†Ô∏è Tools </a> |
      <a href="https://sukkarshop.com" class="footer-link">üè† Homepage</a> |
      <a href="help.html" class="footer-link"> How to use? </a>
    </div>
    <p>Steadfast Bulk Tool v1.78 | Powered by sukkarshop.com</p>
    <p>Disclaimer: This is not an official Steadfast project.</p>
  </footer>

  <script>
    const LS_KEY = 'steadfastApiKey';
    const LS_SECRET = 'steadfastSecretKey';
    let orders = [];

    window.deleteOrder = function (index) {
      if (confirm('‡¶è‡¶á ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
        orders.splice(index, 1);
        renderTable();
      }
    };

    function checkKeys() {
      if (!localStorage.getItem(LS_KEY)) {
        if (confirm('Steadfast API Key ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏‡ßá ‡¶ó‡¶ø‡ßü‡ßá Key ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
          window.location.href = 'index.html';
        }
      }
    }

    function cleanNum(str) {
      if (!str) return '';
      let cleaned = String(str).replace(/[^\d‡ß¶-‡ßØ]/g, '');
      const bn = ['‡ß¶', '‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠', '‡ßÆ', '‡ßØ'], en = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
      bn.forEach((b, i) => cleaned = cleaned.replace(new RegExp(b, 'g'), en[i]));
      return cleaned;
    }

    function cleanPrefixes(text) {
      if (!text) return '';
      return text.replace(/^(‡¶®‡¶æ‡¶Æ|Name|Customer|‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ|Address|‡¶´‡ßã‡¶®|Phone|Mobile|‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤|‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞|Number|‡¶ü‡¶æ‡¶ï‡¶æ|COD|Amount|TK|‡¶ü‡¶æ‡¶ï|‡¶ü‡¶É)[:‡¶É\-\s]*/gi, '').trim();
    }

    function parseSingle(block) {
      const lines = block.split('\n').map(l => l.trim()).filter(Boolean);
      if (lines.length < 3) return null;

      let name = cleanPrefixes(lines[0]);
      let phone = '', addr = '', cod = 0;
      const phoneRx = /^01\d{9}$/;

      for (let l of lines) {
        let p = cleanNum(cleanPrefixes(l));
        if (phoneRx.test(p)) { phone = p; break; }
      }

      addr = cleanPrefixes(lines[1]);

      for (let l of lines) {
        if (l.toLowerCase().includes('tk') || l.includes('‡¶ü‡¶æ‡¶ï‡¶æ') || l.toLowerCase().includes('cod')) {
          cod = parseFloat(cleanNum(l)) || 0; break;
        }
      }
      if (cod === 0 && lines[3]) cod = parseFloat(cleanNum(lines[3])) || 0;

      return {
        invoice: 'B-' + Math.random().toString(36).substring(7).toUpperCase(),
        recipient_name: name,
        recipient_address: addr,
        recipient_phone: phone,
        cod_amount: cod,
        status: 'Pending'
      };
    }

    document.getElementById('extractBtn').onclick = () => {
      const raw = document.getElementById('bulkInput').value;
      const blocks = raw.split('---').map(b => b.trim()).filter(Boolean);
      orders = blocks.map(b => parseSingle(b)).filter(Boolean);
      renderTable();
    };

    function renderTable() {
      const body = document.getElementById('orderBody');
      body.innerHTML = '';
      orders.forEach((o, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
                <td style="font-weight:bold; color:#6b7280;">${idx + 1}</td>
                <td>${o.invoice}</td>
                <td>${o.recipient_name}</td>
                <td>${o.recipient_address}</td>
                <td>${o.recipient_phone}</td>
                <td>${o.cod_amount}</td>
                <td><button class="delete-btn" onclick="deleteOrder(${idx})">‚úï</button></td>
                <td id="status-${idx}" class="status-pending">${o.status}</td>
            `;
        body.appendChild(tr);
      });
      document.getElementById('count').innerText = orders.length;
      document.getElementById('tableWrap').style.display = orders.length ? 'block' : 'none';
    }

    /**
     * ‡¶¨‡ßú ‡¶∏‡¶æ‡¶á‡¶ú‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (16px/12pt Bold)
     */
    function copyFormattedID(id) {
      const text = `Parcel ID: #${id}`;
      const html = `<span style="font-family: 'Poppins', sans-serif; font-size: 16pt; font-weight: bold; color: #000; display: inline-block; background: #f7f7f7;">${text}</span>`;

      const typeHtml = "text/html";
      const typeText = "text/plain";

      const blobHtml = new Blob([html], { type: typeHtml });
      const blobText = new Blob([text], { type: typeText });

      const data = [new ClipboardItem({
        [typeHtml]: blobHtml,
        [typeText]: blobText
      })];

      navigator.clipboard.write(data).then(() => {
        const activeBtn = document.activeElement;
        if (activeBtn && activeBtn.innerText === 'üìã Copy') {
          const original = activeBtn.innerHTML;
          activeBtn.innerHTML = '‚úÖ Copied';
          setTimeout(() => { activeBtn.innerHTML = original; }, 1500);
        }
      }).catch(err => {
        const el = document.createElement('textarea');
        el.value = text;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
      });
    }

    document.getElementById('submitBulkBtn').onclick = async () => {
      const apiKey = localStorage.getItem(LS_KEY);
      const secretKey = localStorage.getItem(LS_SECRET);
      const note = document.getElementById('commonNote').value.trim();

      document.getElementById('submitBulkBtn').disabled = true;
      document.getElementById('summary').innerText = '‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡ßü‡ßá‡¶õ‡ßá...';

      for (let i = 0; i < orders.length; i++) {
        const statusCell = document.getElementById(`status-${i}`);
        statusCell.innerText = '‚è≥ Processing...';

        try {
          const res = await fetch('https://portal.packzy.com/api/v1/create_order', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Api-Key': apiKey,
              'Secret-Key': secretKey
            },
            body: JSON.stringify({
              invoice: orders[i].invoice,
              recipient_name: orders[i].recipient_name,
              recipient_address: orders[i].recipient_address,
              recipient_phone: orders[i].recipient_phone,
              cod_amount: orders[i].cod_amount,
              note: note,
              delivery_type: 0
            })
          });
          const data = await res.json();
          if (data.status === 200) {
            const cid = data.consignment?.consignment_id || 'N/A';
            statusCell.className = 'status-success';
            statusCell.innerHTML = `
                      <div class="parcel-id-box">
                        <span class="id-text">ID: #${cid}</span>
                        <button class="btn btn-secondary" style="padding:2px 5px; font-size:10px;" onclick="copyFormattedID('${cid}')">üìã Copy</button>
                      </div>
                    `;
          } else {
            statusCell.innerText = '‚ùå Failed: ' + (data.message || 'Error');
            statusCell.className = 'status-error';
          }
        } catch (e) {
          statusCell.innerText = '‚ö†Ô∏è Network Error';
          statusCell.className = 'status-error';
        }
        await new Promise(r => setTimeout(r, 600));
      }

      document.getElementById('summary').innerText = '‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§';
      document.getElementById('submitBulkBtn').disabled = false;
    };

    document.getElementById('clearBtn').onclick = () => {
      document.getElementById('bulkInput').value = '';
      document.getElementById('tableWrap').style.display = 'none';
      orders = [];
    };

    checkKeys();
  </script>
</body>

</html>